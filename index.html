<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PWC #2</title>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%; width: 100%;
    overflow: hidden;
    background: black;
    font-family: Arial, sans-serif;
    color: white;
  }
  iframe {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    border: none;
    z-index: 1;
  }
  #watermark {
    position: fixed;
    font-size: 28px;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 5px black;
    z-index: 9999;
    pointer-events: none;
    user-select: none;
    transition: all 0.5s ease;
  }
  #alert-watermark {
    display: none;
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 64px;
    font-weight: bold;
    color: rgba(255,0,0,0.85);
    text-shadow: 3px 3px 10px black;
    z-index: 100000;
    pointer-events: none;
    user-select: none;
    background: rgba(0,0,0,0.7);
    padding: 20px 40px;
    border-radius: 20px;
    white-space: nowrap;
  }
  #duplicate-warning {
    display: none;
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 0, 0, 0.8);
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    z-index: 999999;
    font-weight: bold;
    font-size: 18px;
    user-select: none;
  }
</style>
</head>
<body>

<iframe
  id="ytplayer"
  src="https://www.youtube.com/embed/HVthxP19EXs?autoplay=1&mute=1&fs=1&modestbranding=1&controls=0&rel=0"
  allow="autoplay; encrypted-media"
  allowfullscreen
></iframe>

<div id="watermark">N/A</div>
<div id="duplicate-warning">❌ Tento link je už práve používaný.</div>
<div id="alert-watermark">Čo to? Čo to?</div>

<script>
  const codes = {
    "juraj.mesiarik15@gmail.com": "dandeska69",
    "macatomacko@gmail.com": "d13fxd",
    "lukasradik1@gmail.com": "lukas_mobil_",
    "matkosadovsky7@gmail.com": "PREMIUM7"
  };

  function getParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name)?.toLowerCase();
  }

  const email = getParam('email');
  const watermark = document.getElementById('watermark');
  const iframe = document.getElementById('ytplayer');
  const warning = document.getElementById('duplicate-warning');
  const alertWatermark = document.getElementById('alert-watermark');

  const emailKeys = Object.keys(codes);
  const tokenKey = email ? `ppv_token_${email}` : null;

  const isStorageReset = emailKeys.every(e => localStorage.getItem(`ppv_token_${e}`) === null);

  if (email && codes[email]) {
    const existingToken = localStorage.getItem(tokenKey);
    const sessionToken = sessionStorage.getItem('ppv_token');

    if (!existingToken || isStorageReset) {
      const newToken = crypto.randomUUID();
      localStorage.setItem(tokenKey, newToken);
      sessionStorage.setItem('ppv_token', newToken);
      watermark.textContent = codes[email];
    } else if (existingToken === sessionToken) {
      watermark.textContent = codes[email];
    } else {
      iframe.style.display = 'none';
      watermark.textContent = 'Prístup zamietnutý';
      warning.style.display = 'block';
    }
  } else {
    iframe.style.display = 'none';
    watermark.textContent = "Tvoj kód: Nie je dostupný";
  }

  const positions = [
    { top: "20px", left: "20px", right: "", transform: "none" },
    { top: "20px", left: "50%", right: "", transform: "translateX(-50%)" },
    { top: "20px", left: "auto", right: "20px", transform: "none" }
  ];
  let currentPosition = 0;
  function changeWatermarkPosition() {
    const pos = positions[currentPosition];
    watermark.style.top = pos.top;
    watermark.style.left = pos.left;
    watermark.style.right = pos.right || "";
    watermark.style.transform = pos.transform;
    currentPosition = (currentPosition + 1) % positions.length;
  }
  changeWatermarkPosition();
  setInterval(changeWatermarkPosition, 15000);

  // Zablokovanie PrintScreen a zobraz alert watermark
  document.addEventListener('keydown', e => {
    if (e.key === "PrintScreen") {
      alertWatermark.style.display = 'block';
      setTimeout(() => {
        alertWatermark.style.display = 'none';
      }, 5000);
    }
  });

  // Pri prepnutí stránky zobrazi alert watermark
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
      alertWatermark.style.display = 'block';
    } else {
      alertWatermark.style.display = 'none';
    }
  });

  // Zablokovanie kontext menu a niektorých kláves (ako F12, Ctrl+Shift+I)
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('keydown', e => {
    if (
      e.key === 'F12' ||
      (e.ctrlKey && (e.key === 'u' || e.key === 'c')) ||
      (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'i')
    ) {
      e.preventDefault();
    }
  });

  // Pre autoplay pri dotyku na mobile
  document.addEventListener('touchstart', () => {
    const src = iframe.src;
    if (!src.includes("autoplay=1")) {
      iframe.src = src + "&autoplay=1";
    }
  }, { once: true });
</script>

</body>
</html>
