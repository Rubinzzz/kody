<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PWC #2</title>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%; width: 100%;
      overflow: hidden;
      background: black;
      font-family: Arial, sans-serif;
      color: white;
    }
    body { cursor: none; }

    iframe {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      border: none;
      z-index: 1;
    }

    #watermark {
      position: fixed;
      font-size: 28px;
      font-weight: bold;
      color: white;
      text-shadow: 2px 2px 5px black;
      z-index: 9999;
      pointer-events: none;
      user-select: none;
      transition: all 0.5s ease;
    }

    #screen-blocker-watermark {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 10000;
      color: rgba(255,255,255,0.1);
      font-size: 10vw;
      font-weight: bold;
      user-select: none;
      display: flex;
      justify-content: center;
      align-items: center;
      animation: watermarkMove 20s linear infinite;
      white-space: nowrap;
      transform-origin: center;
      transform: rotate(-45deg);
    }

    @keyframes watermarkMove {
      0%   { transform: translateX(-100%) rotate(-45deg);}
      100% { transform: translateX(100%) rotate(-45deg);}
    }

    #duplicate-warning {
      display: none;
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 0, 0, 0.8);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      z-index: 999999;
      font-weight: bold;
      font-size: 18px;
      user-select: none;
    }
  </style>
</head>
<body>

<iframe
  id="ytplayer"
  src="https://www.youtube.com/embed/HVthxP19EXs?autoplay=1&mute=1&fs=1&modestbranding=1&controls=0&rel=0"
  allow="autoplay; encrypted-media"
  allowfullscreen
></iframe>

<div id="block-yt-full"></div>
<div id="block-yt-top-left"></div>
<div id="block-yt-top-right"></div>
<div id="block-yt-button"></div>
<div id="block-yt-left-button"></div>

<div id="watermark">N/A</div>
<div id="duplicate-warning">❌ Tento link je už práve používaný.</div>

<!-- Transparentný veľký watermark cez celý obraz -->
<div id="screen-blocker-watermark">PPV STREAM - NEZAZNAMENÁVAJ</div>

<script>
  const codes = {
    "juraj.mesiarik15@gmail.com": "dandeska69",
    "macatomacko@gmail.com": "d13fxd",
    "lukasradik1@gmail.com": "lukas_mobil_",
    "matkosadovsky7@gmail.com": "PREMIUM7"
  };

  function getParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name)?.toLowerCase();
  }

  const email = getParam('email');
  const watermark = document.getElementById('watermark');
  const iframe = document.getElementById('ytplayer');
  const warning = document.getElementById('duplicate-warning');

  const emailKeys = Object.keys(codes);
  const tokenKey = email ? `ppv_token_${email}` : null;

  // Check if all tokens were removed = fresh reset
  const isStorageReset = emailKeys.every(e => localStorage.getItem(`ppv_token_${e}`) === null);

  if (email && codes[email]) {
    const existingToken = localStorage.getItem(tokenKey);
    const sessionToken = sessionStorage.getItem('ppv_token');

    if (!existingToken || isStorageReset) {
      const newToken = crypto.randomUUID();
      localStorage.setItem(tokenKey, newToken);
      sessionStorage.setItem('ppv_token', newToken);
      watermark.textContent = codes[email];
    } else if (existingToken === sessionToken) {
      watermark.textContent = codes[email];
    } else {
      iframe.style.display = 'none';
      watermark.textContent = 'Prístup zamietnutý';
      warning.style.display = 'block';
    }
  } else {
    iframe.style.display = 'none';
    watermark.textContent = "Tvoj kód: Nie je dostupný";
  }

  const positions = [
    { top: "20px", left: "20px", right: "", transform: "none" },
    { top: "20px", left: "50%", right: "", transform: "translateX(-50%)" },
    { top: "20px", left: "auto", right: "20px", transform: "none" }
  ];
  let currentPosition = 0;
  function changeWatermarkPosition() {
    const pos = positions[currentPosition];
    watermark.style.top = pos.top;
    watermark.style.left = pos.left;
    watermark.style.right = pos.right || "";
    watermark.style.transform = pos.transform;
    currentPosition = (currentPosition + 1) % positions.length;
  }
  changeWatermarkPosition();
  setInterval(changeWatermarkPosition, 15000);

  // Blokovanie pravého tlačítka, inspectu, atď.
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('keydown', e => {
    if (
      e.key === 'F12' ||
      e.key.toLowerCase() === 'f' ||
      (e.ctrlKey && (e.key === 'u' || e.key === 'c')) ||
      (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'i') ||
      e.key === 'PrintScreen'
    ) {
      e.preventDefault();
      alert('Screenshot / nahrávanie je zakázané.');
    }
  });
  document.addEventListener('dblclick', e => e.preventDefault());

  // Video pozastaví, keď používateľ prepne kartu alebo okno
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
      iframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
    } else {
      iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
    }
  });

  document.addEventListener('touchstart', () => {
    const src = iframe.src;
    if (!src.includes("autoplay=1")) {
      iframe.src = src + "&autoplay=1";
    }
  }, { once: true });
</script>

</body>
</html>
